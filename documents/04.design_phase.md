# Документация фазы дизайна

Фаза дизайна представляет собой критически важный этап разработки программного обеспечения, преобразующий одобренные требования в детализированный технический план реализации. Этот документ служит официальным руководством для всей команды, обеспечивая единую точку отсчета для архитекторов, разработчиков, тестировщиков и заинтересованных сторон.

**Ключевая ценность фазы дизайна**:

- Создает "мост" между бизнес-требованиями и технической реализацией
- Выявляет и решает потенциальные проблемы до начала кодирования
- Обеспечивает прозрачность и согласованность в принятии решений
- Служит основой для оценки трудозатрат и планирования работ
- Уменьшает риски недопонимания и переделок на этапе реализации

## Цель и задачи

Создать технически обоснованный, реализуемый и проверяемый дизайн, полностью соответствующий утвержденным требованиям и готовый к разбивке на задачи реализации.

**Трансформация требований**  

- Перевод функциональных требований в архитектурные компоненты
- Преобразование нефункциональных требований (производительность, безопасность) в технические решения

**Проведение целевых исследований**  

- Анализ технологических вариантов для критически важных компонентов
- Изучение лучших практик и шаблонов проектирования
- Оценка рисков и ограничений выбранных решений

**Определение структуры системы**  

- Выделение ключевых модулей и их взаимодействия
- Проектирование интерфейсов между компонентами
- Разработка моделей данных и их трансформаций

**Планирование надежности**  

- Проектирование обработки ошибок и восстановления
- Определение стратегий тестирования на всех уровнях
- Обеспечение соответствия требованиям безопасности

**Документирование решений**  

- Фиксация всех архитектурных решений с обоснованием
- Создание прослеживаемости между требованиями и элементами дизайна
- Подготовка материала для передачи разработчикам

---

## Принципы интеграции исследований

Определение области исследований:

- **Фокус на критически важных решениях**. Исследуйте только те аспекты, которые напрямую влияют на архитектуру или имеют высокий уровень неопределенности. Например, выбор между синхронной и асинхронной обработкой платежей требует глубокого анализа, тогда как выбор цветовой схемы интерфейса может основываться на существующих гайдлайнах.
- **Ограниченное время**. Устанавливайте четкие временные рамки для исследований.
- **Действенные выводы** Изучайте и сохраняйте только информацию, которая непосредственно влияет на принятие решений.

Документирование исследований:

- **Контекстная связь**. Каждый вывод должен явно ссылаться на конкретное требование или проблему.
- **Ссылки на источники**. Включайте прямые ссылки на документацию, статьи, примеры кода.
- **Интеграция в дизайн**. Не храните исследования изолированно. Внедряйте ключевые выводы непосредственно в соответствующие разделы архитектурного документа.
- **Обоснование решений**. Для каждого принятого решения укажите:  
  - Рассмотренные альтернативы
  - Критерии оценки
  - Причины выбора текущего варианта
  - Потенциальные компромиссы

---

## Пошаговый процесс

### Шаг 1: Анализ требований и планирование исследований

**Цель**: Глубоко понять требования и выявить области, требующие исследований, с четким определением объема и границ.

> Данный шаг может быть пропущен, в случае, если не планируется применение новых технологий или архитектурных паттернов.

**Процесс**:

1. **Тщательный обзор требований**  
2. **Выявление областей для исследований**  
3. **Планирование исследовательской деятельности**. Для каждой области определите цель исследования и критерии успеха
4. **Установление границ исследований**  

**Что документировать**:

- Контекст проекта и связь с бизнес-целями
- Перечень исследований с обоснованием приоритетов
- Ожидаемые результаты и их влияние на архитектуру
- Границы исследований и критерии завершения

---

### Шаг 2: Проведение исследований и построение контекста

**Цель**: Собрать достаточную информацию для обоснованных архитектурных решений, избегая избыточного анализа.

> Данный шаг может быть пропущен, в случае, если не планируется применение новых технологий или архитектурных паттернов.

**Процесс**:

1. **Сбор информации**  
   - Изучите официальную документацию, технические блоги, case studies
   - Проведите экспериментальные тесты (proof-of-concept) для критических функций
   - Проконсультируйтесь с экспертами внутри или вне организации

2. **Оценка вариантов**  
   - Для каждого варианта определите:
     - Технические характеристики
     - Требуемые усилия
     - Потенциальные риски
     - Соответствие нефункциональным требованиям

3. **Документирование итогов исследований**  
   - Создайте краткое резюме с фокусом на решениях
   - Укажите источники информации для проверки
   - Отметьте неопределенности и необходимость дополнительных исследований

4. **Принятие предварительных решений**  
   - На основе исследований сформулируйте рекомендации
   - Укажите обоснование выбора и потенциальные компромиссы

**Что документировать**:

- Ключевые выводы с привязкой к требованиям
- Сравнение альтернатив с оценкой по критериям
- Обоснование выбранных технологий и паттернов
- Ссылки на источники и материалы для проверки
- Неопределенности и рекомендации по их разрешению

---

### Шаг 3: Создание системной архитектуры

**Цель**: Определить высокоуровневую структуру решения, которая полностью удовлетворяет требованиям и готова к детализации.

**Компоненты архитектуры**:

1. **Обзор системы**  
   - Диаграмма компонентов (рекомендуется использовать C4-модель)
   - Краткое описание основных потоков данных
   - Связь с существующей инфраструктурой

2. **Архитектура компонентов**  
   - Перечень основных модулей с описанием их назначения
   - Границы ответственности каждого компонента
   - Связи между компонентами (синхронные/асинхронные)

3. **Поток данных**  
   - Описание жизненного цикла ключевых сущностей
   - Места хранения данных на каждом этапе
   - Преобразования данных между компонентами

4. **Точки интеграции**  
   - Внешние системы и API с указанием версий
   - Протоколы взаимодействия и форматы данных
   - Стратегии обработки недоступности внешних систем

5. **Технологический стек**  
   - Явное обоснование выбора каждой технологии
   - Версии используемых инструментов
   - План миграции для устаревших компонентов

**Что документировать**:

- Диаграмму архитектуры с пояснениями
- Обоснование выбора архитектурного стиля (микросервисы, монолит и т.д.)
- Как архитектура удовлетворяет функциональным и нефункциональным требованиям
- Риски архитектурных решений и пути их минимизации

**Важно**: Описывайте только компоненты, необходимые для решения текущих требований. Избегайте проектирования "на будущее" без явных требований.

---

### Шаг 4: Определение компонентов и интерфейсов

**Цель**: Детализировать внутреннюю структуру системы и способы взаимодействия компонентов, обеспечивая готовность к реализации.

**Элементы дизайна компонентов**:

1. **Обязанности компонентов**. Четкое описание того, что делает компонент
2. **Определения интерфейсов**  
3. **Отношения зависимостей**  
4. **Конфигурация и настройка**  

**Что документировать**:

- Для каждого компонента отдельный подраздел с полным описанием
- Примеры вызовов и ответов для всех интерфейсов
- Диаграммы последовательности для ключевых сценариев
- Правила обработки ошибок на уровне компонента

---

### Шаг 5: Дизайн моделей данных

**Цель**: Определить структуру данных и правила их обработки, обеспечивающие целостность и соответствие бизнес-правилам.

**Элементы модели данных**:

1. **Определения сущностей: данные и обязаности**  
2. **Отношения между сущностями**  
3. **Правила валидации и бизнес-логика сущностей**  
4. **Стратегии хранения**  

**Что документировать**:

- ERD-диаграмму с пояснениями
- Для каждой сущности — полное описание полей
- Примеры данных для ключевых сценариев
- Стратегии миграции данных при изменении схемы

---

### Шаг 6: Планирование обработки ошибок и граничных случаев

**Цель**: Обеспечить надежность системы при возникновении проблем, определив четкие стратегии обработки всех возможных сценариев.

**Дизайн обработки ошибок**:

1. **Выделить категории ошибок**. Системные ошибки, ошибки валидации данныхи и тд
2. **Стратегии ответа на ошибки**  
3. **Пользовательский опыт в ошибочных сценариях**  
4. **Механизмы восстановления**
5. **Механизмы мониторинга**

**Что документировать**:

- Для каждой ключевой операции — матрицу возможных ошибок и стратегий
- Примеры обработки для критических сценариев
- Форматы логов и метрик для отслеживания ошибок
- Порядок действий при возникновении критических инцидентов

### Шаг 7: Определение стратегии тестирования

**Цель**: Обеспечить качество реализации через продуманную стратегию тестирования, охватывающую все аспекты системы.

**Элементы стратегии тестирования**:

1. **Определить уровни тестирования**  
2. **Покрытие тестами: критерии охвата, приоритеты**  
3. **Тестовые сценарии**  
4. **Инструменты тестирования**  
5. **Контрольные точки качества**  

**Что документировать**:

- Для каждого компонента — уровень и тип необходимых тестов
- Метрики качества и их целевые значения
- Примеры тестовых сценариев для ключевых функций
- Интеграцию стратегии тестирования с процессом разработки

---

### Шаг 8: Финальная проверка качества дизайна

**Цель**: Убедиться, что дизайн полный, понятный и готов к реализации, соответствует всем критериям качества.

**Чек-лист качества**:

| Категория            | Критерий проверки                                           | Метод проверки                       |
| -------------------- | ----------------------------------------------------------- | ------------------------------------ |
| **Полнота**          | Все требования адресованы в дизайне                         | Сопоставление требований и дизайна   |
|                      | Основные системные компоненты определены                    | Проверка диаграмм и описаний         |
|                      | Модели данных покрывают все необходимые сущности            | Анализ ERD и описаний                |
|                      | Обработка ошибок покрывает ожидаемые режимы сбоев           | Проверка матрицы ошибок              |
| **Ясность**          | Решения дизайна четко объяснены                             | Чтение документа новым разработчиком |
|                      | Обязанности компонентов хорошо определены                   | Проверка описаний компонентов        |
|                      | Интерфейсы между компонентами специфицированы               | Анализ контрактов API                |
|                      | Технические выборы включают обоснование                     | Проверка разделов исследований       |
| **Осуществимость**   | Дизайн технически достижим с выбранными технологиями        | Консультация с экспертами            |
|                      | Требования производительности могут быть выполнены          | Анализ стратегий оптимизации         |
|                      | Требования безопасности адресованы                          | Проверка мер безопасности            |
|                      | Сложность реализации соответствует оценкам проекта          | Оценка разработчиками                |
| **Прослеживаемость** | Элементы дизайна связаны с конкретными требованиями         | Матрица прослеживаемости             |
|                      | Все требования покрыты компонентами дизайна                 | Проверка полноты                     |
|                      | Решения дизайна поддерживают выполнение требований          | Анализ соответствия                  |
|                      | Стратегия тестирования валидирует удовлетворение требований | Проверка тестовых сценариев          |

---

## Распространенные ошибки дизайна

### Ошибка 1: Избыточное проектирование

**Проблема**: Проектирование для требований, которых не существует, или добавление функциональности "на будущее".

**Симптомы**:

- Дизайн включает компоненты без прямой связи с текущими требованиями
- Сложные абстракции для сценариев, которые могут никогда не реализоваться
- Увеличение срока проектирования без явной пользы

**Решение**:

- Фокусируйтесь строго на текущих требованиях
- Используйте принцип YAGNI (You Aren't Gonna Need It)
- Дизайн должен быть расширяемым, но не реализовывать неиспользуемые функции
- Регулярно задавайте вопрос: "Какое конкретное требование обосновывает этот компонент?"

### Ошибка 2: Недостаточно специфицированные интерфейсы

**Проблема**: Расплывчатые границы и взаимодействия компонентов, приводящие к недопониманию при реализации.

**Симптомы**:

- Неясно, за что отвечает каждый компонент
- Отсутствие четких контрактов API
- Многочисленные уточняющие вопросы во время реализации

**Решение**:

- Четко определите входы, выходы и ошибки для каждого интерфейса
- Используйте формальные спецификации (OpenAPI, Protobuf)
- Включите примеры вызовов и ответов
- Проведите ревью интерфейсов с разработчиками перед реализацией

### Ошибка 3: Игнорирование нефункциональных требований

**Проблема**: Фокус только на функциональном поведении, игнорирование производительности, безопасности и других нефункциональных аспектов.

**Симптомы**:

- Отсутствие упоминаний о времени отклика, нагрузке, безопасности
- Нет стратегий масштабирования или резервирования
- Не определены метрики качества

**Решение**:

- Явно пропишите все нефункциональные требования в отдельном разделе
- Для каждого укажите измеримые метрики (например, "Время отклика < 500ms при 1000 RPS")
- Включите в дизайн элементы, обеспечивающие выполнение NFR
- Проверьте соответствие NFR на этапе финальной проверки

### Ошибка 4: Дизайн, ориентированный на технологии

**Проблема**: Выбор технологий до полного понимания требований, приводящий к неоптимальным решениям.

**Симптомы**:

- Технологии упоминаются раньше, чем определены требования
- Сравнение технологий без привязки к конкретным задачам
- Избыточное усложнение из-за использования "модных" технологий

**Решение**:

- Позвольте требованиям направлять выбор технологий, а не наоборот
- Для каждой технологии укажите конкретное требование, которое она удовлетворяет
- Рассмотрите простые решения перед сложными
- Используйте матрицу оценки технологий с критериями, основанными на требованиях

### Ошибка 5: Недостаточный дизайн обработки ошибок

**Проблема**: Проектирование только для счастливого пути, игнорирование сценариев сбоя.

**Симптомы**:

- Отсутствие раздела об обработке ошибок
- Нет стратегий восстановления после сбоев
- Не определены сообщения об ошибках для пользователей

**Решение**:

- Явно проектируйте обработку ошибок наравне с основным потоком
- Для каждой операции определите возможные сценарии сбоя
- Включите в дизайн механизмы повторных попыток, fallback-стратегии, мониторинг
- Убедитесь, что пользовательский опыт продуман для всех сценариев

---

## Устранение проблем дизайна

### Проблема: Дизайн становится слишком сложным

**Симптомы**:

- Документ дизайна превышает 2500 строк без явной необходимости
- Слишком много компонентов и взаимодействий
- Трудно объяснить архитектуру новому члену команды

**Решение**:

- Вернитесь к требованиям и удалите элементы без прямой связи
- Рассмотрите поэтапную реализацию (MVP + последующие итерации)
- Проведите рефакторинг архитектуры, объединяя связанные компоненты

### Проблема: Требования не отображаются на дизайн

**Симптомы**:

- Сложность прослеживания требований к элементам дизайна
- Некоторые требования не отражены в дизайне
- Нет явной связи между бизнес-целями и техническими решениями

**Решение**:

- Создайте матрицу прослеживаемости "требования-дизайн"
- Проведите пошаговую проверку каждого требования
- Добавьте ссылки на требования в соответствующие разделы дизайна

### Проблема: Технологические выборы неясны

**Симптомы**:

- Множество жизнеспособных вариантов без четких критериев выбора
- Отсутствие обоснования для выбранных технологий

**Решение**:

- Определите критерии решений на основе требований и ограничений
- Создайте матрицу сравнения с оценкой по ключевым критериям
- Проведите proof-of-concept для критически важных решений
- Документируйте обоснование выбора с указанием компромиссов

### Проблема: Дизайну не хватает деталей для реализации

**Симптомы**:

- Много вопросов во время реализации
- Неоднозначность в интерфейсах и контрактах

**Решение**:

- Добавьте конкретные примеры вызовов и ответов
- Уточните форматы данных и коды ошибок
- Включите диаграммы последовательности для ключевых сценариев

---

## Заключение

Дизайн-документ — это не просто формальный артефакт, а живой инструмент, обеспечивающий успешную реализацию проекта. Качественный дизайн:

- Сокращает количество ошибок и переделок
- Ускоряет процесс разработки за счет четких указаний
- Упрощает передачу знаний между членами команды
- Служит основой для оценки качества реализации

**Ключевые принципы эффективного дизайна**:

1. **Минимальная достаточность** — проектируйте ровно столько, сколько необходимо для реализации
2. **Практическая ориентация** — фокус на решениях, готовых к реализации
3. **Прозрачность решений** — каждое решение должно иметь четкое обоснование
4. **Живой документ** — регулярно обновляйте дизайн по мере получения новых данных

## Шаблон документа

```md
# Дизайн "[Краткое название функциональности]"

[Краткое описание бизнес-целей, связь с корпоративной стратегией, ключевые заинтересованные стороны]

[Четкое определение границ системы: что входит/не входит в решение]

---

## Системная архитектура

[Общее описание флоу работы функции, перечисление компонентов, связей между ними и DF между ними]

---

## Компоненты и интерфейсы

**Для каждого ключевого компонента создать подраздел:**

### [Название компонента]

[Что делает компонент]

[Связи с другими компонентами]

[Ссылка на исходные требования]

**Нефункциональные требования**

[Нефункциональные требования к компоненту]

- Производительность: [Метрики + стратегии]  
- Безопасность: [Механизмы защиты]  
- Надежность: [Стратегии резервирования]

**Стратегия обработки ошибок**

[Стратегия обработки ошибок]

**Стратегия тестирования**

* [Тестовый кейс]
   * Описание кейса
* [Другой тестовый кейс]
   * Описание кейса

---

## Системные сущности

### [Название сущности]

[Описание сущности]

[Ссылка на исходные требования]

**Методы сущности**

* [Метод сущности]
   * Описание метода и его поведения
* [Другой метод сущности]
   * Описание метода и его поведения

**Данные сущности**

* [Поле сущности]
   * Описание поля и его поведения
* [Другое поле сущности]
   * Описание поля и его поведения

**Стратегия тестирования**

* [Тестовый кейс]
   * Описание кейса
* [Другой тестовый кейс]
   * Описание кейса

---

## Чек-лист качества требований

*(Заполняется после завершения документа)*

| Критерий                                                             | Выполнено | Комментарий |
| -------------------------------------------------------------------- | --------- | ----------- |
| Все требования имеют однозначное отражение в дизайне                  | ☐        |             |
| Нефункциональные требования переведены в измеримые технические решения | ☐        |             |
| Продумана обработка ошибок для всех ключевых сценариев               | ☐        |             |
| Модель данных покрывает все бизнес-сущности и правила                 | ☐        |             |
| Определена стратегия тестирования с уровнями и метриками качества      | ☐        |             |
| Дизайн соответствует принципу минимальной достаточности (YAGNI)       | ☐        |             |
| Существует система прослеживаемости требований → элементы дизайна     | ☐        |             |

```
